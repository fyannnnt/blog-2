<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 3.9.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>WecTeam</title>


<link rel="icon" href="/images/favicon.ico">

<link rel="stylesheet" href="//cdn.bootcss.com/gitalk/1.5.0/gitalk.min.css">
<script src="//cdn.bootcss.com/gitalk/1.5.0/gitalk.min.js"></script>
<script src="https://unpkg.com/blueimp-md5@2.12.0/js/md5.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/5.4.1/css/all.min.css">
<!--<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">-->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/og_image.png" alt="Node.js项目TypeScript改造指南(二)" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">主页</a>
                
                <a class="navbar-item"
                href="/categories">分类</a>
                
                <a class="navbar-item"
                href="/tags">标签</a>
                
                <a class="navbar-item"
                href="/about">关于我们</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="WecTeam on GitHub" href="https://github.com/wecteam">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card">
    
    <div class="card-image">
        <span  class="image is-7by1">
            <img class="thumbnail" src="https://tva1.sinaimg.cn/large/006tNbRwgy1ga362vbkc8j30p00anq52.jpg" alt="Node.js项目TypeScript改造指南(二)">
        </span>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <!--<time class="level-item has-text-grey" datetime="2019-12-20T06:26:07.000Z">2019-12-20</time>-->
                <div class="level-item has-text-grey">2019-12-20</div>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Node-js/">Node.js</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    38 分钟 读完 (大约 5654 个字)
                </span>
                
                
                
                    <!-- 不蒜子统计 -->
                    <span class="level-item has-text-grey" id="busuanzi_container_page_pv" style='display:none' >
                           阅读数：<span id="busuanzi_value_page_pv"></span>次
                    </span>
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                Node.js项目TypeScript改造指南(二)
            
        </h1>
        <div class="content">
            <blockquote>
<p>作者：刘辉</p>
</blockquote>
<p>最近笔者把一个中等规模的 Koa2 项目迁移到 TypeScript，和大家分享一下 TypeScript 实践中的经验和技巧。</p>
<p>原项目基于 Koa2，MySQL，sequelize，request，接口加页面总计 100 左右。迁移后项目基于 Midway，MySQL，sequelize-typescript，axios。</p>
<p>本项目使用 TypeScript3.7，TypeScript 配置如下：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-string">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="hljs-string">"declaration"</span>: <span class="hljs-literal">false</span>,</span><br><span class="line">    <span class="hljs-string">"emitDecoratorMetadata"</span>: <span class="hljs-literal">true</span>,</span><br><span class="line">    <span class="hljs-string">"experimentalDecorators"</span>: <span class="hljs-literal">true</span>,</span><br><span class="line">    <span class="hljs-string">"incremental"</span>: <span class="hljs-literal">true</span>,</span><br><span class="line">    <span class="hljs-string">"inlineSourceMap"</span>: <span class="hljs-literal">true</span>,</span><br><span class="line">    <span class="hljs-string">"module"</span>: <span class="hljs-string">"commonjs"</span>,</span><br><span class="line">    <span class="hljs-string">"newLine"</span>: <span class="hljs-string">"lf"</span>,</span><br><span class="line">    <span class="hljs-string">"noFallthroughCasesInSwitch"</span>: <span class="hljs-literal">true</span>,</span><br><span class="line">    <span class="hljs-string">"noUnusedLocals"</span>: <span class="hljs-literal">true</span>,</span><br><span class="line">    <span class="hljs-string">"outDir"</span>: <span class="hljs-string">"dist"</span>,</span><br><span class="line">    <span class="hljs-string">"pretty"</span>: <span class="hljs-literal">true</span>,</span><br><span class="line">    <span class="hljs-string">"skipLibCheck"</span>: <span class="hljs-literal">true</span>,</span><br><span class="line">    <span class="hljs-string">"strict"</span>: <span class="hljs-literal">true</span>,</span><br><span class="line">    <span class="hljs-string">"strictPropertyInitialization"</span>: <span class="hljs-literal">false</span>,</span><br><span class="line">    <span class="hljs-string">"stripInternal"</span>: <span class="hljs-literal">true</span>,</span><br><span class="line">    <span class="hljs-string">"target"</span>: <span class="hljs-string">"ES2017"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>本文分为两部分，第一部分是处理 any 的实践，第二部分是构建类型系统的实践。</p>
<a id="more"></a>

<h2 id="对-any-的处理"><a href="#对-any-的处理" class="headerlink" title="对 any 的处理"></a>对 any 的处理</h2><p>使用 TypeScript 就不得不面对 any 带来的问题，首先来看看为什么 any 值得我们认真对待。</p>
<h3 id="any-的危害"><a href="#any-的危害" class="headerlink" title="any 的危害"></a>any 的危害</h3><p>我们来看这段代码：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">a: number, b: number</span>):<span class="hljs-title">number</span> </span>&#123;</span><br><span class="line">     <span class="hljs-keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">var</span> a:any = <span class="hljs-string">'1'</span>;</span><br><span class="line"><span class="hljs-keyword">var</span> b = <span class="hljs-number">2</span>;</span><br><span class="line"><span class="hljs-built_in">console</span>.log(add(a,b))  <span class="hljs-comment">// '12'</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>代码可以直接粘贴到 <a href="https://www.typescriptlang.org/play/index.html" target="_blank" rel="noopener">Playground</a> 执行 </p>
</blockquote>
<p>add 的本意是两个数字相加，但是因为 a 其实是字符串，通过使用 any 类型跳过了类型检查，所以变成了字符串连接，输出了字符串 “12”，而且这个 “12” 依然被当成 number 类型向下传递。</p>
<p>当然，我们一般不会犯这么明显的错误，那么再来看这个例子：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> resData = <span class="hljs-string">`&#123;"a":"1","b":2&#125;`</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">a: number, b: number</span>):<span class="hljs-title">number</span> </span>&#123;</span><br><span class="line">     <span class="hljs-keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">var</span> obj = <span class="hljs-built_in">JSON</span>.parse(resData);</span><br><span class="line"><span class="hljs-built_in">console</span>.log(add(obj.a,obj.b))  <span class="hljs-comment">// '12'</span></span><br></pre></td></tr></table></figure>

<p>我们假设 resData 为接口返回的 json 字符串，我们用JSON.parse解析出数据然后相加，为什么类型检查没有提醒我 obj.a 不是 number 类型？</p>
<p>因为 JSON.parse 的签名是这样的：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// lib.es5.d.ts</span></span><br><span class="line">parse(text: string, reviver?: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">this</span>: any, key: string, value: any</span>) =&gt;</span> any): any;</span><br></pre></td></tr></table></figure>

<p>JSON.parse 返回的是 any 类型，不受类型检查约束，数据从进入 add 方法以后，才受类型检查约束，但是这时数据类型已经对不上了。</p>
<p>在这种数据类型已经对不上真实类型的情况下，我们怎么进行纠正？来看以下的代码：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">var</span> resData = <span class="hljs-string">`&#123;"a":"1","b":2&#125;`</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">a: number, b: number</span>):<span class="hljs-title">number</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">var</span> c = <span class="hljs-built_in">parseInt</span>(a) <span class="hljs-comment">// Error: Argument of type 'number' is not assignable to parameter of type 'string'.</span></span><br><span class="line">    <span class="hljs-keyword">var</span> d:string = a <span class="hljs-keyword">as</span> string <span class="hljs-comment">//Error: Conversion of type 'number' to type 'string' may be a mistake because neither type sufficiently overlaps with the other. If this was intentional, convert the expression to 'unknown' first.</span></span><br><span class="line">    <span class="hljs-keyword">var</span> e = <span class="hljs-built_in">Number</span>(a)</span><br><span class="line">    <span class="hljs-keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">var</span> obj = <span class="hljs-built_in">JSON</span>.parse(resData);</span><br><span class="line"><span class="hljs-built_in">console</span>.log(add(obj.a,obj.b))</span><br></pre></td></tr></table></figure>

<p>parseInt 只接受 string 类型参数，a 已经被推断为 number，因此报错。<br>使用 as 更改类型同样报错，编译器建议如果一定要更改类型，需要使用 unknown 类型中转一下。<br>Number() 可以进行正确的转换，因为 Number 上有这样一个签名：参数为 any，可以接受任何类型的参数。</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// lib.es5.d.ts</span></span><br><span class="line">interface NumberConstructor &#123;</span><br><span class="line">    <span class="hljs-comment">// ...</span></span><br><span class="line">    (value?: any): number;</span><br><span class="line">    <span class="hljs-comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line">declare <span class="hljs-keyword">var</span> <span class="hljs-built_in">Number</span>: NumberConstructor;</span><br></pre></td></tr></table></figure>

<p>然而这样做，我们的类型检查还有意义吗？为什么不直接写js？</p>
<h3 id="any-的来源"><a href="#any-的来源" class="headerlink" title="any 的来源"></a>any 的来源</h3><p>TypeScript 在 3.0 版本之前，只有 any 这样一个顶级类型。如果有一个值来自动态的内容，我们在定义的时候并不确定它的类型时，any 可能是唯一的选择，<a href="https://www.typescriptlang.org/docs/handbook/basic-types.html?#any" target="_blank" rel="noopener">官方文档</a>也是如此解释的。因此我们可以看到 any 在基础库、第三方库中普遍存在。</p>
<p>但是 any 跳过了类型检查，确实给我们带来了隐患，为了保证多人协作时不因此引发问题，我们需要想办法让这种危险可控。</p>
<p>首先，我们需要明确系统中哪里有 any。</p>
<ul>
<li>开启严格选项</li>
</ul>
<p>在 tsconfig.json 的 compilerOptions 属性中开启严格选项 <code>&quot;strict&quot;: true</code>。此选项可以保证，我们自己写的代码不会制造出隐式的 any。</p>
<ul>
<li>了解基础库、第三方库中的类型</li>
</ul>
<p>写代码时，应注意基础库、第三方库中函数输入输出是否使用了 any，类型、接口是否直接、间接使用了 any。</p>
<p>最典型的，例如 require：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">interface NodeRequireFunction &#123;</span><br><span class="line">    <span class="hljs-comment">/* tslint:disable-next-line:callable-types */</span></span><br><span class="line">    (id: string): any;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>) <span class="hljs-comment">// require 引入的内容都是 any</span></span><br></pre></td></tr></table></figure>

<p>还有 JSON：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-comment">// 一个对象使用了 JSON.parse(JSON.stringify(obj)) 就会变成 any 类型，不再受类型检查约束</span></span><br><span class="line">interface <span class="hljs-built_in">JSON</span> &#123;</span><br><span class="line">    parse(text: string, reviver?: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">this</span>: any, key: string, value: any</span>) =&gt;</span> any): any;</span><br><span class="line">    stringify(value: any, replacer?: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">this</span>: any, key: string, value: any</span>) =&gt;</span> any, space?: string | number): string;</span><br><span class="line">    stringify(value: any, replacer?: (number | string)[] | <span class="hljs-literal">null</span>, space?: string | number): string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于本项目来说，Koa 的 ctx 上的 query：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// @types/koa/index.d.ts</span></span><br><span class="line">declare interface ContextDelegatedRequest &#123;</span><br><span class="line">    <span class="hljs-comment">// ...</span></span><br><span class="line">    header: any;</span><br><span class="line">    headers: any;</span><br><span class="line">    query: any;</span><br><span class="line">    <span class="hljs-comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Axios 请求方法的泛型参数上的默认类型 T，如果 get 上没有注明返回的数据类型来覆盖 T，res.data 的类型就是 any：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// axios/index.d.ts</span></span><br><span class="line">interface AxiosInstance &#123;</span><br><span class="line">    <span class="hljs-keyword">get</span>&lt;T = any, R = AxiosResponse&lt;T&gt;&gt;(url: string, config?: AxiosRequestConfig): Promise&lt;R&gt;;</span><br><span class="line">&#125;</span><br><span class="line">interface AxiosResponse&lt;T = any&gt;  &#123;</span><br><span class="line">  data: T;</span><br><span class="line">  status: number;</span><br><span class="line">  statusText: string;</span><br><span class="line">  headers: any;</span><br><span class="line">  config: AxiosRequestConfig;</span><br><span class="line">  request?: any;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>不显式使用 any</li>
</ul>
<p>也就是自己不写 any。</p>
<p>使用 any 可能出于以下几个理由：</p>
<ol>
<li>需要顶级类型</li>
<li>暂时不知道类型怎么写</li>
<li>项目迁移方便</li>
<li>写第三方库，使用者用起来方便</li>
</ol>
<p>顶级类型可以考虑使用 unknown 代替；暂时不知道怎么写或者项目迁移，还是应该尽早消灭 any；对于写第三方库，本文无此方面实践，欢迎大家思考提建议。</p>
<h3 id="让-any-可控"><a href="#让-any-可控" class="headerlink" title="让 any 可控"></a>让 any 可控</h3><p>本项目处理 any 的思路很简单，不显式使用 any，使用 unknown 作为顶级类型。接收到一个 any 类型的数据时使用类型守护「<a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#type-guards-and-differentiating-types" target="_blank" rel="noopener">Type Guards</a>」或者断言函数「<a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-7.html#assertion-functions" target="_blank" rel="noopener">Assertion Functions</a>」来明确数据类型，然后把类型守护函数和断言函数统一管理。</p>
<h4 id="用-unknown-作为顶级类型"><a href="#用-unknown-作为顶级类型" class="headerlink" title="用 unknown 作为顶级类型"></a>用 unknown 作为顶级类型</h4><p>TypeScript 3.0 增加了新的顶级类型 <a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-0.html#new-unknown-top-type" target="_blank" rel="noopener">unknown</a>。</p>
<blockquote>
<p>TypeScript 3.0 introduces a new top type unknown. unknown is the type-safe counterpart of any. Anything is assignable to unknown, but unknown isn’t assignable to anything but itself and any without a type assertion or a control flow based narrowing. Likewise, no operations are permitted on an unknown without first asserting or narrowing to a more specific type.   – typescript handbook</p>
</blockquote>
<p>unknown 可以看做是类型安全的 any。任何类型的数据都可以赋值给一个 unknown 变量，但是 unknown 类型的数据只能分配给 unknown 和 any 类型。我们必须通过断言或者收窄把 unknown 变成一个具体的类型，否则无法进行其他操作。</p>
<p>我们把之前使用 any 的代码改成 unknown 看一下：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">a: number, b: number</span>):<span class="hljs-title">number</span> </span>&#123;</span><br><span class="line">     <span class="hljs-keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">var</span> a:unknown = <span class="hljs-string">'1'</span>;</span><br><span class="line"><span class="hljs-keyword">var</span> b = <span class="hljs-number">2</span>;</span><br><span class="line"><span class="hljs-built_in">console</span>.log(add(a,b))  <span class="hljs-comment">// Error: Argument of type 'unknown' is not assignable to parameter of type 'number'.</span></span><br></pre></td></tr></table></figure>

<p>unknown 类型不能赋值给 number 类型。</p>
<p>我们使用类型守护把 unknown 收窄，因为 a 的真实类型不是 number 因此会走到 else 分支：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">a: number, b: number</span>):<span class="hljs-title">number</span> </span>&#123;</span><br><span class="line">     <span class="hljs-keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">var</span> a:unknown = <span class="hljs-string">'1'</span>;</span><br><span class="line"><span class="hljs-keyword">var</span> b = <span class="hljs-number">2</span>;</span><br><span class="line"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> a == <span class="hljs-string">"number"</span>) &#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(add(a,b))</span><br><span class="line">&#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'params error'</span>)</span><br><span class="line">&#125;  </span><br><span class="line"><span class="hljs-comment">// params error</span></span><br></pre></td></tr></table></figure>

<h4 id="类型守护-amp-断言函数"><a href="#类型守护-amp-断言函数" class="headerlink" title="类型守护 &amp; 断言函数"></a>类型守护 &amp; 断言函数</h4><p>类型守护可以使用 in 操作符、typeof、instanceof 来收窄类型。除此之外，还可以自定义类型守护函数。断言函数的功能类似，例如下面一段代码，用类型守护和断言函数处理 any 类型的 ctx.body。</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 定义一个类型</span></span><br><span class="line">interface ApiCreateParams &#123;</span><br><span class="line">    name:string</span><br><span class="line">    info:string</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-comment">// 确认data上是否有names中的字段</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasFieldOnBody</span>&lt;<span class="hljs-title">T</span> <span class="hljs-title">extends</span> <span class="hljs-title">string</span>&gt;(<span class="hljs-params">obj:unknown,names:Array&lt;T&gt;</span>) :<span class="hljs-title">obj</span> <span class="hljs-title">is</span> </span>&#123; [P <span class="hljs-keyword">in</span> T]:unknown &#125; &#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> obj === <span class="hljs-string">"object"</span> &amp;&amp; obj !== <span class="hljs-literal">null</span> &amp;&amp; names.every(<span class="hljs-function"><span class="hljs-params">name</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> name <span class="hljs-keyword">in</span> obj</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertApiCreateParams</span>(<span class="hljs-params">data:unknown</span>):<span class="hljs-title">asserts</span> <span class="hljs-title">data</span> <span class="hljs-title">is</span> <span class="hljs-title">ApiCreateParams</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span>( hasFieldOnBody(data,[<span class="hljs-string">'name'</span>, <span class="hljs-string">'info'</span>]) &amp;&amp; <span class="hljs-keyword">typeof</span> data.name === <span class="hljs-string">"string"</span> &amp;&amp; <span class="hljs-keyword">typeof</span> data.info === <span class="hljs-string">"string"</span> )&#123;</span><br><span class="line">            <span class="hljs-built_in">console</span>.log(data.name,data.info,data) </span><br><span class="line">            <span class="hljs-comment">// data.name 的类型为 string，data.info的类型为string，但是data的类型是&#123;name:unknown,info:unknown&#125;</span></span><br><span class="line">    &#125;<span class="hljs-keyword">else</span>&#123;</span><br><span class="line">        <span class="hljs-keyword">throw</span> <span class="hljs-string">"api create params error"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="hljs-keyword">get</span>('/create')  // midway controller 上定义的方法，处理 /create 路由</span><br><span class="line">async create(): Promise&lt;void&gt; &#123;</span><br><span class="line">    <span class="hljs-keyword">let</span> data = <span class="hljs-keyword">this</span>.ctx.request.body; <span class="hljs-comment">// data的类型为any</span></span><br><span class="line">    assertApiCreateParams(data);</span><br><span class="line">    <span class="hljs-built_in">console</span>.log(data)  <span class="hljs-comment">// data的类型已经被推断为ApiCreateParams</span></span><br><span class="line">    <span class="hljs-comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对 unknown 进行类型收窄在处理复杂 JSON 时会比较繁琐，我们可以结合 JSON Schema 来进行验证。<br>自定义断言函数本质上是把类型验证的工作交给了开发者，一个错误的断言函数，或者直接写一个空的断言函数，同样会导致类型系统推导错误。<br>但是我们可以把断言函数管理起来，比如制定断言函数的命名规范，把断言函数集中在一个文件管理。<br>这样可以使不安全因素更可控，比到处都是 any 安全的多。</p>
<h4 id="不要使用类型断言「type-assertions」处理-any"><a href="#不要使用类型断言「type-assertions」处理-any" class="headerlink" title="不要使用类型断言「type-assertions」处理 any"></a>不要使用类型断言「<a href="https://www.typescriptlang.org/docs/handbook/basic-types.html#type-assertions" target="_blank" rel="noopener">type-assertions</a>」处理 any</h4><p>主流静态类型语言基本都提供了类型转换，类型转换会尝试把数据转换成需要的类型，转换失败时会报错。TypeScript 的类型断言「type-assertions」语法上像极了类型转换，但是它并不是类型安全的。</p>
<blockquote>
<p>Type assertions are a way to tell the compiler “trust me, I know what I’m doing.” A type assertion is like a type cast in other languages, but performs no special checking or restructuring of data. It has no runtime impact, and is used purely by the compiler. TypeScript assumes that you, the programmer, have performed any special checks that you need.    – typescript handbook</p>
</blockquote>
<p>尤其是对一个 any 类型使用 as 时，肯定不会失败，例如：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span> (<span class="hljs-params">a:number,b:number</span>)</span>&#123;</span><br><span class="line">     <span class="hljs-keyword">var</span> c = a + b;</span><br><span class="line">     <span class="hljs-built_in">console</span>.log(c);</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">var</span> a: any = <span class="hljs-string">'1'</span>;</span><br><span class="line"><span class="hljs-keyword">var</span> b = <span class="hljs-number">2</span></span><br><span class="line"><span class="hljs-keyword">var</span> c = a <span class="hljs-keyword">as</span> number;</span><br><span class="line">add(c, b);  <span class="hljs-comment">// '12'</span></span><br></pre></td></tr></table></figure>

<p>我们想把 a 转换成数字来相加，数字和字符串原本不能直接做类型转换，但是 any 不受类型检查约束。 最后还是返回了字符串 “12”，而不是我们想要的 3。</p>
<h4 id="覆盖第三方库中的-any"><a href="#覆盖第三方库中的-any" class="headerlink" title="覆盖第三方库中的 any"></a>覆盖第三方库中的 any</h4><p>我们可以通过继承的方式，把第三方库原有 any 类型覆盖掉，换成 unknown 或者更具体的类型。<br>例如处理 Koa Context 上的 query 和 request.body。</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">interface ParsedUrlQuery &#123; [key: string]: string | string[]; &#125; <span class="hljs-comment">// copy from querystring.d.ts </span></span><br><span class="line"></span><br><span class="line">interface IBody &#123; [key: string]: unknown; &#125;</span><br><span class="line"></span><br><span class="line">interface RequestPlus extends Request&#123; <span class="hljs-attr">body</span>:IBody &#125;</span><br><span class="line"></span><br><span class="line">interface ContextPlus extends Context&#123;</span><br><span class="line">    query:ParsedUrlQuery</span><br><span class="line">    request:RequestPlus</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 Midway 中使用：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@provide()</span><br><span class="line">@controller(<span class="hljs-string">'/api'</span>)</span><br><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractController</span> </span>&#123;</span><br><span class="line">    @inject()</span><br><span class="line">    ctx: ContextPlus;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="构建强大的类型系统"><a href="#构建强大的类型系统" class="headerlink" title="构建强大的类型系统"></a>构建强大的类型系统</h2><p>使用 TypeScript 经常会遇到的一个问题就是，需要写很多类型，但是有很多类型都很相似，每个类型都重新定义感觉很啰嗦，很容易违反 DRY 原则。</p>
<p>本项目是一个管理系统，核心模型就是数据库表，对应到代码里首先就是 Model 层，围绕这个核心会有很多 Model 类型的变体和衍生类型。例如，SQL 的查询条件，增删改查接口的各种参数；Model 里可能是数字类型，但是 url query 上都当字符串类型传过来；创建参数不包含 id 字段，更新参数包含 id 字段，但是其他字段可选；两个 Model 的一部分合并一个新的对象，等等。。</p>
<p>接下来我们将通过 TypeScript 提供的功能，构建合理且精简的类型系统。</p>
<h3 id="接口继承"><a href="#接口继承" class="headerlink" title="接口继承"></a>接口继承</h3><p>接口继承大家应该都不陌生，以带分页功能的查询参数为例：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">interface Paging &#123;</span><br><span class="line">    pageIndex:number</span><br><span class="line">    pageSize:number</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-comment">// 继承 Paging 的新类型</span></span><br><span class="line">interface APIQueryParams extends Paging &#123;</span><br><span class="line">    keyword:string</span><br><span class="line">    title:string</span><br><span class="line">&#125; </span><br><span class="line"><span class="hljs-comment">// 继承 Paging 的新类型</span></span><br><span class="line">interface PackageQueryParams extends Paging &#123;</span><br><span class="line">    name:string</span><br><span class="line">    desc:string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="类型推导"><a href="#类型推导" class="headerlink" title="类型推导"></a>类型推导</h3><p>TypeScript 2.8 增加了条件类型「<a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-8.html#conditional-types" target="_blank" rel="noopener">Conditional Types</a>」。</p>
<p>结合 keyof、never、in 等特性，使 TypeScript 具有了一定程度上的类型运算能力，可以让我们获得一个类型的变体和衍生类型。</p>
<h4 id="可供使用的工具"><a href="#可供使用的工具" class="headerlink" title="可供使用的工具"></a>可供使用的工具</h4><h5 id="交叉类型「Intersection-Types」-和-联合类型「Union-Types」"><a href="#交叉类型「Intersection-Types」-和-联合类型「Union-Types」" class="headerlink" title="交叉类型「Intersection Types」 和 联合类型「Union Types」"></a>交叉类型「<a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#intersection-types" target="_blank" rel="noopener">Intersection Types</a>」 和 联合类型「<a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#union-types" target="_blank" rel="noopener">Union Types</a>」</h5><p>假设我们有 Serializable 和 Loggable 两个类型。</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">type Serializable = &#123;<span class="hljs-attr">toString</span>:<span class="hljs-function">(<span class="hljs-params">data:unknown</span>) =&gt;</span> string&#125;</span><br><span class="line"></span><br><span class="line">type Loggable = &#123;<span class="hljs-attr">log</span>:<span class="hljs-function">(<span class="hljs-params">data:unknown</span>) =&gt;</span> <span class="hljs-keyword">void</span>&#125;</span><br><span class="line"></span><br><span class="line">type A = Serializable &amp; Loggable</span><br><span class="line"></span><br><span class="line">type B = Serializable | Loggable</span><br></pre></td></tr></table></figure>

<p>类型 A 表示一个交叉类型，它需要同时满足 Serializable 和 Loggable。</p>
<p>类型 B 表示一个联合类型，它只要满足 Serializable 和 Loggable 其中之一即可。</p>
<p><code>如果我们把一个类型看做一组规则的 Map，交叉类型就是取并集，联合类型就是取其中之一。</code></p>
<h5 id="索引类型「Index-types」和映射类型「Mapped-types」"><a href="#索引类型「Index-types」和映射类型「Mapped-types」" class="headerlink" title="索引类型「Index types」和映射类型「Mapped types」"></a>索引类型「<a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#index-types" target="_blank" rel="noopener">Index types</a>」和映射类型「<a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#mapped-types" target="_blank" rel="noopener">Mapped types</a>」</h5><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">type Person = &#123;</span><br><span class="line">    name: string;</span><br><span class="line">    age: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type PersonKeys = keyof Person; <span class="hljs-comment">// 'name' | 'age'</span></span><br><span class="line"></span><br><span class="line">type PersonMap = &#123; </span><br><span class="line"></span><br><span class="line">    [K <span class="hljs-keyword">in</span> PersonKeys]: boolean </span><br><span class="line"></span><br><span class="line">&#125;;  <span class="hljs-comment">// &#123; name:boolean,age:boolean &#125;</span></span><br><span class="line"></span><br><span class="line">type PersonMapEx1 = &#123; </span><br><span class="line"></span><br><span class="line">    [K <span class="hljs-keyword">in</span> PersonKeys]: Person[K] | boolean </span><br><span class="line"></span><br><span class="line">&#125;;  <span class="hljs-comment">// &#123; name: string | boolean,age:string | number &#125;</span></span><br><span class="line"></span><br><span class="line">type PersonMapEx2 = &#123; </span><br><span class="line"></span><br><span class="line">    [K <span class="hljs-keyword">in</span> PersonKeys]: Person[K] </span><br><span class="line"></span><br><span class="line">&#125;[<span class="hljs-string">"name"</span>];  <span class="hljs-comment">// string</span></span><br><span class="line"></span><br><span class="line">type PersonMapEx3 = &#123; </span><br><span class="line"></span><br><span class="line">    [K <span class="hljs-keyword">in</span> PersonKeys]: Person[K] </span><br><span class="line"></span><br><span class="line">&#125;[<span class="hljs-string">"name"</span>|<span class="hljs-string">"age"</span>];   <span class="hljs-comment">// string|number</span></span><br><span class="line"></span><br><span class="line">type PersonMapEx4 = &#123; </span><br><span class="line"></span><br><span class="line">    [K <span class="hljs-keyword">in</span> PersonKeys]: Person[K] </span><br><span class="line"></span><br><span class="line">&#125;[keyof Person];   <span class="hljs-comment">// string|number</span></span><br><span class="line"></span><br><span class="line">type PersonMapEx5 = Person[<span class="hljs-string">'name'</span>|<span class="hljs-string">'age'</span>]; <span class="hljs-comment">// string|number</span></span><br></pre></td></tr></table></figure>

<p>PersonKeys 是一个索引类型，同时也是联合类型，通过 Keyof 实现。<br>PersonMap 是一个映射类型，使用 in 实现遍历，注意映射类型的格式。<br>观察 PersonMapEx1-5，可以发现，在类型定义中，<code>{}</code> 用来构造一个键值对，<code>[]</code> 用来放置key或key组成的联合，<code>{}[]</code> 可以用来取对应 key 的类型。</p>
<p><code>如果我们把一个类型看做一组规则组成的 Map，key 是属性名，value 是类型，keyof 使我们有了取得所有 key 的能力。</code></p>
<p><code>in 使我们有了对一个索引类型/联合类型遍历、重新设置每个属性的类型的能力。</code></p>
<h5 id="条件类型「Conditional-Types」"><a href="#条件类型「Conditional-Types」" class="headerlink" title="条件类型「Conditional Types」"></a>条件类型「<a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-8.html#conditional-types" target="_blank" rel="noopener">Conditional Types</a>」</h5><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">type Circle = &#123;</span><br><span class="line">    rad:number,</span><br><span class="line">    x:number,</span><br><span class="line">    y:number</span><br><span class="line">&#125;</span><br><span class="line">type TypeName&lt;T&gt; = T extends &#123;<span class="hljs-attr">rad</span>:number&#125; ? Circle : unknown</span><br><span class="line">type T1 = TypeName&lt;&#123;<span class="hljs-attr">rad</span>:number&#125;&gt;  <span class="hljs-comment">// Circle</span></span><br><span class="line">type T2= TypeName&lt;&#123;<span class="hljs-attr">rad</span>:string&#125;&gt;  <span class="hljs-comment">// unknown</span></span><br></pre></td></tr></table></figure>

<p>以上是一个最基本的条件类型，条件类型基于泛型，通过对泛型参数操作获取新类型。<br>extend 在这里表示可兼容的「assignable」，和鸭子类型的机制一样，<code>如果把类型看做集合，也可以理解为集合上的包含关系</code>。<br><code>?:</code> 和 js 的三目运算符功能一致，<code>使我们具备了条件分支的能力</code>。<br>在上例中，TypeName 是一个条件类型，T1、T2 是把泛型参数明确以后通过条件分支得到的类型。</p>
<p>另外，我们还可以用在映射类型中提到的 <code>{}[]</code> 的形式表达复杂的判断逻辑，例如以下这段来自 Vue 的代码，虽然看着复杂，但是只要明确了<code>extends ?: {} []</code>这些符号的作用，就很容易理清代码表达的意思：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// https://github.com/vuejs/vue-next/blob/master/packages/reactivity/src/ref.ts</span></span><br><span class="line"><span class="hljs-keyword">export</span> type UnwrapRef&lt;T&gt; = &#123;</span><br><span class="line">  cRef: T extends ComputedRef&lt;infer V&gt; ? UnwrapRef&lt;V&gt; : T</span><br><span class="line">  ref: T extends Ref&lt;infer V&gt; ? UnwrapRef&lt;V&gt; : T</span><br><span class="line">  array: T extends <span class="hljs-built_in">Array</span>&lt;infer V&gt; ? <span class="hljs-built_in">Array</span>&lt;UnwrapRef&lt;V&gt;&gt; &amp; UnwrapArray&lt;T&gt; : T</span><br><span class="line">  object: &#123; [K <span class="hljs-keyword">in</span> keyof T]: UnwrapRef&lt;T[K]&gt; &#125;</span><br><span class="line">&#125;[T extends ComputedRef&lt;any&gt;</span><br><span class="line">  ? <span class="hljs-string">'cRef'</span></span><br><span class="line">  : T extends Ref</span><br><span class="line">    ? <span class="hljs-string">'ref'</span></span><br><span class="line">    : T extends <span class="hljs-built_in">Array</span>&lt;any&gt;</span><br><span class="line">      ? <span class="hljs-string">'array'</span></span><br><span class="line">      : T extends <span class="hljs-built_in">Function</span> | CollectionTypes</span><br><span class="line">        ? <span class="hljs-string">'ref'</span> <span class="hljs-comment">// bail out on types that shouldn't be unwrapped</span></span><br><span class="line">        : T extends object ? <span class="hljs-string">'object'</span> : <span class="hljs-string">'ref'</span>]</span><br></pre></td></tr></table></figure>

<p>如果 T 可以解释为联合类型，在条件判断中可以进行展开，除了联合类型，any、boolean、使用 keyof 得到的索引类型，都可以展开。例如：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">type F&lt;T&gt; = T extends U ? X : Y</span><br><span class="line">type union_type = A | B | C</span><br><span class="line">type FU = F&lt;union_type&gt;  <span class="hljs-comment">//  a的结果为 A extends U ? X :Y | B extends U ? X :Y | C extends U ? X : Y</span></span><br><span class="line"></span><br><span class="line">type Params = &#123;</span><br><span class="line">    name: string;</span><br><span class="line">    title:string;</span><br><span class="line">    id: number;</span><br><span class="line">&#125;</span><br><span class="line">type UX&lt;T&gt; = &#123; [K <span class="hljs-keyword">in</span> keyof T]: T[K] extends string ? T[K] : string&#125;</span><br><span class="line">type StringFields&lt;T&gt; = &#123; [K <span class="hljs-keyword">in</span> keyof T]: T[K] extends string ? K : never &#125;[keyof T]</span><br><span class="line">type U1 = UX&lt;Params&gt; <span class="hljs-comment">// &#123;name:string,title:string,id:string&#125;</span></span><br><span class="line">type U2 = StringFields&lt;Params&gt; <span class="hljs-comment">// "name"|"title"</span></span><br></pre></td></tr></table></figure>

<p>注意类型 StringFields<t> 中的 <a href="https://www.typescriptlang.org/docs/handbook/basic-types.html#never" target="_blank" rel="noopener">never</a>，never 是TypeScript 的基础类型之一，表示不可到达。</t></p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 返回never的函数必须存在无法达到的终点</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">error</span>(<span class="hljs-params">message: string</span>): <span class="hljs-title">never</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>在条件类型中，起到了过滤的效果。也就是说 never 让我们有了从一个类型中删减规则的能力。</code></p>
<p><code>除此之外，还有一个关键词 infer 即 inference 的缩写，使我们具备了代换、提取类型的能力。</code></p>
<p>官方的例子：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">type Unpacked&lt;T&gt; =</span><br><span class="line">    T extends (infer U)[] ? U :</span><br><span class="line">    T extends (...args: any[]) =&gt; infer U ? U :</span><br><span class="line">    T extends <span class="hljs-built_in">Promise</span>&lt;infer U&gt; ? U :</span><br><span class="line">    T;</span><br><span class="line"></span><br><span class="line">type T0 = Unpacked&lt;string&gt;;  <span class="hljs-comment">// string</span></span><br><span class="line">type T1 = Unpacked&lt;string[]&gt;;  <span class="hljs-comment">// string</span></span><br><span class="line">type T2 = Unpacked&lt;<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> string&gt;;  <span class="hljs-comment">// string</span></span><br><span class="line">type T3 = Unpacked&lt;<span class="hljs-built_in">Promise</span>&lt;string&gt;&gt;;  <span class="hljs-comment">// string</span></span><br><span class="line">type T4 = Unpacked&lt;<span class="hljs-built_in">Promise</span>&lt;string&gt;[]&gt;;  <span class="hljs-comment">// Promise&lt;string&gt;</span></span><br><span class="line">type T5 = Unpacked&lt;Unpacked&lt;<span class="hljs-built_in">Promise</span>&lt;string&gt;[]&gt;&gt;;  <span class="hljs-comment">// string</span></span><br></pre></td></tr></table></figure>

<p>在 <code>T extends</code> 后面的类型表达式上，我们可以对一个可以表达为类型的符号使用 infer，然后在输出类型中使用 infer 引用的类型，至于这个类型具体是什么，会在 T 被确定时自动推导出来。<br>示例代码的功能就是从数组、函数、Promise 中解出其中的类型。</p>
<h5 id="可选-amp-只读属性"><a href="#可选-amp-只读属性" class="headerlink" title="可选 &amp; 只读属性"></a>可选 &amp; 只读属性</h5><figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type MutableRequired&lt;T&gt; = &#123; -readonly [P <span class="hljs-keyword">in</span> keyof T]-?: T[P] &#125;;  <span class="hljs-comment">// Remove readonly and ?</span></span><br><span class="line">type ReadonlyPartial&lt;T&gt; = &#123; +readonly [P <span class="hljs-keyword">in</span> keyof T]+?: T[P] &#125;;  <span class="hljs-comment">// Add readonly and ?</span></span><br></pre></td></tr></table></figure>

<p>我们可以给类型属性增加只读或者可选标记，使用 - 号，可以把原本带有的只读和可选标记去掉，+ 代表增加，可以省略。</p>
<h5 id="基础库中提供的抽象类型"><a href="#基础库中提供的抽象类型" class="headerlink" title="基础库中提供的抽象类型"></a>基础库中提供的抽象类型</h5><p>以上述能力为基础，基础库中提供了许多常用的抽象类型，为得到衍生类型和变体提供了很大帮助。以 TypeScript 3.7 为例：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">type Circle = &#123;</span><br><span class="line">    rad:number,</span><br><span class="line">    x:number,</span><br><span class="line">    y:number,</span><br><span class="line">    name:string</span><br><span class="line">&#125;</span><br><span class="line">type Params = &#123;</span><br><span class="line">    name: string;</span><br><span class="line">    title:string;</span><br><span class="line">    id: number;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">constructor</span> (x:number,y:number)&#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.x = x;</span><br><span class="line">        <span class="hljs-keyword">this</span>.y = y;</span><br><span class="line">    &#125;</span><br><span class="line">    x:number;y:number;</span><br><span class="line">&#125;</span><br><span class="line">type a1 = Partial&lt;Params&gt; <span class="hljs-comment">// 使Params上的字段变为可选</span></span><br><span class="line">type a2 = Required&lt;Params&gt; <span class="hljs-comment">// 使Params上的字段变为必选</span></span><br><span class="line">type a3 = Readonly&lt;Params&gt; <span class="hljs-comment">// 使Params上的字段变为只读</span></span><br><span class="line">type a4 = Pick&lt;Params,<span class="hljs-string">'name'</span>|<span class="hljs-string">'id'</span>&gt; <span class="hljs-comment">// 提前Params上的name和id  &#123;name:string,id:number&#125;</span></span><br><span class="line">type a5 = Record&lt;<span class="hljs-string">'a'</span>|<span class="hljs-string">'b'</span>,Params&gt; <span class="hljs-comment">// 用a,b做key，Params为value建立类型  &#123;a:Params,b:Params&#125;</span></span><br><span class="line">type a6 = Exclude&lt;keyof Circle,keyof Params&gt; <span class="hljs-comment">// 排除Circle上Params也有的字段  "rad"|"x"|"y"</span></span><br><span class="line">type a7 = Extract&lt;keyof Circle,keyof Params&gt; <span class="hljs-comment">// 提取Circle和Params的公共字段  "name"</span></span><br><span class="line">type a8 = Omit&lt;Circle,<span class="hljs-string">'name'</span>&gt; <span class="hljs-comment">// 从Circle上去掉name字段 &#123;x:number,y:number:rad:number&#125;</span></span><br><span class="line">type a9 = NonNullable&lt;Params&gt; <span class="hljs-comment">// 去掉为空的字段</span></span><br><span class="line">type a10 = Parameters&lt;<span class="hljs-function">(<span class="hljs-params">name:string,id:number</span>)=&gt;</span><span class="hljs-keyword">void</span>&gt; <span class="hljs-comment">// 提取函数参数类型 [string,number]</span></span><br><span class="line">type a11 = ConstructorParameters&lt;<span class="hljs-keyword">typeof</span> Shape&gt; <span class="hljs-comment">// 提取Shape的构造器参数 [number,number]</span></span><br><span class="line">type a12 = ReturnType&lt;<span class="hljs-function"><span class="hljs-params">()</span>=&gt;</span>Params&gt; <span class="hljs-comment">// 提取函数返回类型 Params</span></span><br><span class="line">type a13 = InstanceType&lt;<span class="hljs-keyword">typeof</span> Shape&gt; <span class="hljs-comment">// 提取实例类型 Shape</span></span><br></pre></td></tr></table></figure>

<h5 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h5><p>以一个简化的模块为例，首先使用 sequelize-typescript 提供的基类 Model 和装饰器创建一个业务类。</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">import</span> &#123; DataType, Model,Column,Comment,AutoIncrement,PrimaryKey &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'sequelize-typescript'</span>;</span><br><span class="line"><span class="hljs-keyword">const</span> &#123; STRING,TEXT,INTEGER,ENUM &#125; = DataType;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiModel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Model</span>&lt;<span class="hljs-title">ApiModel</span>&gt; </span>&#123;</span><br><span class="line">    @AutoIncrement</span><br><span class="line">    @PrimaryKey</span><br><span class="line">    @Comment(<span class="hljs-string">"id"</span>)</span><br><span class="line">    @Column(&#123; <span class="hljs-attr">type</span>: INTEGER(&#123;<span class="hljs-attr">length</span>:<span class="hljs-number">11</span>&#125;), <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span> &#125;)</span><br><span class="line">    id!: number;</span><br><span class="line"></span><br><span class="line">    @Comment(<span class="hljs-string">"parent"</span>)</span><br><span class="line">    @Column(&#123; <span class="hljs-attr">type</span>: INTEGER(&#123;<span class="hljs-attr">length</span>:<span class="hljs-number">11</span>&#125;), <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span> &#125;)</span><br><span class="line">    parent!: number;</span><br><span class="line"></span><br><span class="line">    @Comment(<span class="hljs-string">"name"</span>)</span><br><span class="line">    @Column(&#123; <span class="hljs-attr">type</span>: STRING(<span class="hljs-number">255</span>), <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span> &#125;)</span><br><span class="line">    name!: string;</span><br><span class="line"></span><br><span class="line">    @Comment(<span class="hljs-string">"url"</span>)</span><br><span class="line">    @Column(&#123; <span class="hljs-attr">type</span>: STRING(<span class="hljs-number">255</span>), <span class="hljs-attr">allowNull</span>: <span class="hljs-literal">false</span> &#125;)</span><br><span class="line">    url!: string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此业务类继承了 Model，Model 上有大量的属性和方法，如 version、createdAt、init() 等。我们需要获取一个只包含业务属性的类型，因为创建和更新只会传这几个字段，并且创建时没有 id。查询的时候，字段为可选的。下面我们根据需求来定义类型：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-comment">// 使用 Omit 排除掉基类上定义的属性和方法，因为基类上也定义了 id，因此要把 id 留下</span></span><br><span class="line">type ApiObject = Omit&lt;ApiModel,Exclude&lt;keyof Model,<span class="hljs-string">"id"</span>&gt;&gt;  <span class="hljs-comment">// &#123;id:number,parent:number,name:string,url:string&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 合并两个类型,T优先</span></span><br><span class="line">type Merge&lt;T,S&gt; = &#123; [ K <span class="hljs-keyword">in</span> keyof(T &amp; S) ] : (K extends keyof T ? T[K] : K extends keyof S ? S[K] :never ) &#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 创建Api使用的参数，id为自增，所以要去掉id</span></span><br><span class="line">type ApiCreateParams = Omit&lt;ApiObject,<span class="hljs-string">"id"</span>&gt;  <span class="hljs-comment">// &#123;parent:number,name:string,url:string&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 查询参数，创建参数上的字段可选，使用Partial将字段全部变为可选 带分页功能，因此要和分页类型合并</span></span><br><span class="line"><span class="hljs-comment">// 用上面定义的 Merge 方法合并类型</span></span><br><span class="line">type ApiQueryParams = Merge&lt;Partial&lt;ApiCreateParams&gt;,Paging&gt; <span class="hljs-comment">// &#123;id?:number,parent?:number,name?:string,pageIndex:number,pageSize:number&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment">// 分页类型的定义</span></span><br><span class="line">type Paging = &#123;</span><br><span class="line">    pageIndex:number</span><br><span class="line">    pageSize:number</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="收窄类型"><a href="#收窄类型" class="headerlink" title="收窄类型"></a>收窄类型</h3><p>TypeScript 没有提供类型转换的能力，我们如何从 any、unknown、复杂的联合类型中获取具体类型就成为一个问题。</p>
<p>as 可以用来收窄类型，但是风险很大，例如：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type c1 = &#123; <span class="hljs-attr">name</span>:string,<span class="hljs-attr">id</span>:number &#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">var</span> v1 = &#123; <span class="hljs-attr">name</span>:<span class="hljs-string">'cccc'</span> &#125; <span class="hljs-keyword">as</span> c1</span><br></pre></td></tr></table></figure>

<p>这段代码不会报错，但是 v1 上其实没有 id 属性，造成了隐患。</p>
<p>对于可能为 null 的类型或可选属性，我们可以用 <a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-3-7.html#optional-chaining" target="_blank" rel="noopener">Optional Chaining</a> 来调用。例如：</p>
<figure class="highlight ts hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-keyword">interface</span> erpValidateResult &#123;</span><br><span class="line">    retcode:<span class="hljs-built_in">number</span></span><br><span class="line">    msg?:<span class="hljs-built_in">string</span></span><br><span class="line">    data?:&#123; [username: <span class="hljs-built_in">string</span>]:<span class="hljs-built_in">string</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-keyword">declare</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">erpValidate</span>(<span class="hljs-params">opt:&#123;id:<span class="hljs-built_in">number</span>&#125;</span>):<span class="hljs-title">Promise</span>&lt;<span class="hljs-title">erpValidateResult</span>&gt;</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-title">erpValidate</span>(<span class="hljs-params">&#123;id:1&#125;</span>).<span class="hljs-title">then</span>(<span class="hljs-params">res=&gt;&#123;</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">    <span class="hljs-keyword">var</span> name = res.data?.username || ""</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">&#125;</span>)</span></span><br></pre></td></tr></table></figure>

<p>对于 any、unknown，可使用前面提到的类型守护和断言函数收窄。</p>
<p>使用可辨识联合「<a href="https://www.typescriptlang.org/docs/handbook/advanced-types.html#discriminated-unions" target="_blank" rel="noopener">Discriminated Unions</a>」可以让我们区分相似的类型。例如：</p>
<figure class="highlight js hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">interface Square &#123;</span><br><span class="line">    kind: <span class="hljs-string">"square"</span>;</span><br><span class="line">    size: number;</span><br><span class="line">&#125;</span><br><span class="line">interface Rectangle &#123;</span><br><span class="line">    kind: <span class="hljs-string">"rectangle"</span>;</span><br><span class="line">    width: number;</span><br><span class="line">    height: number;</span><br><span class="line">&#125;</span><br><span class="line">interface Circle &#123;</span><br><span class="line">    kind: <span class="hljs-string">"circle"</span>;</span><br><span class="line">    radius: number;</span><br><span class="line">&#125;</span><br><span class="line">type Shape = Square | Rectangle | Circle;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">area</span>(<span class="hljs-params">s: Shape</span>) </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">switch</span> (s.kind) &#123;</span><br><span class="line">        <span class="hljs-keyword">case</span> <span class="hljs-string">"square"</span>: <span class="hljs-keyword">return</span> s.size * s.size;  <span class="hljs-comment">// Square</span></span><br><span class="line">        <span class="hljs-keyword">case</span> <span class="hljs-string">"rectangle"</span>: <span class="hljs-keyword">return</span> s.height * s.width;  <span class="hljs-comment">// Rectangle</span></span><br><span class="line">        <span class="hljs-keyword">case</span> <span class="hljs-string">"circle"</span>: <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.PI * s.radius ** <span class="hljs-number">2</span>; <span class="hljs-comment">// Circle</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>kind 属性是一个字符串字面量类型，而且在联合类型 Shape 的每一个子类型上都不一样，这个 kind 属性就被称为可辨识的特征或 tag。我们就可以用 kind 来收窄类型。 </p>
<p>条件类型允许我们为类型建立包含关系，也是收窄的一种方式。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>TypeScript 是个强大并且灵活的工具，而且它的特性还在逐步完善。</p>
<p>我们可以把它当成类型标注来用，让我们开发时能够从 IDE 得到大量提示，避免语法、拼写错误，这时候我们可以不那么严谨，继续用动态语言的思路写代码。</p>
<p>我们也可以把它当成类型约束来用，这可能会增加我们的工作量。我们除了维护代码本身，还要维护类型系统，而且创建一个精简、合理的类型系统可能并不是一件简单的事。</p>

        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/Web性能优化/">Web性能优化</a>
                </div>
            </div>
        </div>
        
        
        
    </div>
        <div id="gitalk-container" style="margin: 30px;padding-bottom: 30px;"></div>
        <script>
            var gitalk = new Gitalk({
                clientID: '2bea76e30455b7301744', // GitHub Application Client ID
                clientSecret: '36efc910fcaff27be701dbcbc1925f7ca61ad0ea', // GitHub Application Client Secret
                repo: 'blog',      // 存放评论的仓库
                owner: 'wecteam',          // 仓库的创建者，
                admin: ['qianguyihao','antiter','steelli','mk33mk333'],        // 如果仓库有多个人可以操作，那么在这里以数组形式写出
                id: md5(location.pathname),      // 用于标记评论是哪个页面的，确保唯一，并且长度小于50
                title: document.title,
                body:  '文章链接：'+ decodeURIComponent(location.origin+location.pathname),
            })
    
    
            if(location.pathname != '/')gitalk.render('gitalk-container');    // 渲染Gitalk评论组件
        </script>
        
    
</div>





<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2019/12/20/京东微信购物首页性能优化实践/">
                <span class="level-item">京东微信购物首页性能优化实践</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>


</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img  src="/images/avatar.png" alt=" ">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                         
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                         
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>中国 深圳</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <p class="title has-text-weight-normal">
                        32
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <p class="title has-text-weight-normal">
                        4
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <p class="title has-text-weight-normal">
                        40
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/wecteam" target="_blank">
                关注我</a>
        </div>
        
        
    </div>
</div>
    
        
    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://aotu.io/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">凹凸实验室</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">aotu.io</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://75team.com/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">奇舞团</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">75team.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="http://www.alloyteam.com/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">alloyteam</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.alloyteam.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Node-js/">
            <span class="level-start">
                <span class="level-item">Node.js</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">6</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Web前端/">
            <span class="level-start">
                <span class="level-item">Web前端</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">18</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Web后端/">
            <span class="level-start">
                <span class="level-item">Web后端</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Web开发/">
            <span class="level-start">
                <span class="level-item">Web开发</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">7</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/AST/" style="font-size: 16.67px;">AST</a> <a href="/tags/BDD-TDD/" style="font-size: 13.33px;">BDD/TDD</a> <a href="/tags/Badjs/" style="font-size: 10px;">Badjs</a> <a href="/tags/CLI/" style="font-size: 10px;">CLI</a> <a href="/tags/CPU性能优化/" style="font-size: 10px;">CPU性能优化</a> <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/CSS-Houdini/" style="font-size: 10px;">CSS Houdini</a> <a href="/tags/Electron/" style="font-size: 10px;">Electron</a> <a href="/tags/Interection-Observer/" style="font-size: 13.33px;">Interection Observer</a> <a href="/tags/Mocha/" style="font-size: 13.33px;">Mocha</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/Promise/" style="font-size: 10px;">Promise</a> <a href="/tags/TypeScript/" style="font-size: 13.33px;">TypeScript</a> <a href="/tags/V8引擎/" style="font-size: 10px;">V8引擎</a> <a href="/tags/Vue-compile/" style="font-size: 10px;">Vue.compile</a> <a href="/tags/Web性能优化/" style="font-size: 20px;">Web性能优化</a> <a href="/tags/canvas/" style="font-size: 10px;">canvas</a> <a href="/tags/composite/" style="font-size: 10px;">composite</a> <a href="/tags/modulepreload/" style="font-size: 10px;">modulepreload</a> <a href="/tags/rollup打包/" style="font-size: 10px;">rollup打包</a> <a href="/tags/type-module/" style="font-size: 10px;">type="module"</a> <a href="/tags/webpack-loader/" style="font-size: 10px;">webpack loader</a> <a href="/tags/web内容/" style="font-size: 10px;">web内容</a> <a href="/tags/代码拆分/" style="font-size: 10px;">代码拆分</a> <a href="/tags/前端工程化/" style="font-size: 10px;">前端工程化</a> <a href="/tags/向量/" style="font-size: 10px;">向量</a> <a href="/tags/字体/" style="font-size: 10px;">字体</a> <a href="/tags/居中对齐/" style="font-size: 10px;">居中对齐</a> <a href="/tags/工程化/" style="font-size: 10px;">工程化</a> <a href="/tags/引导蒙层/" style="font-size: 10px;">引导蒙层</a> <a href="/tags/性能优化/" style="font-size: 13.33px;">性能优化</a> <a href="/tags/折叠屏适配/" style="font-size: 10px;">折叠屏适配</a> <a href="/tags/桌面开发/" style="font-size: 10px;">桌面开发</a> <a href="/tags/测试框架/" style="font-size: 13.33px;">测试框架</a> <a href="/tags/滚动优化/" style="font-size: 10px;">滚动优化</a> <a href="/tags/火焰图/" style="font-size: 10px;">火焰图</a> <a href="/tags/电池电量/" style="font-size: 10px;">电池电量</a> <a href="/tags/碰撞检测/" style="font-size: 10px;">碰撞检测</a> <a href="/tags/设计原则/" style="font-size: 10px;">设计原则</a> <a href="/tags/资源治理/" style="font-size: 10px;">资源治理</a>
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2019/12/20/Node-js项目TypeScript改造指南-二/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://tva1.sinaimg.cn/large/006tNbRwgy1ga362vbkc8j30p00anq52.jpg" alt="Node.js项目TypeScript改造指南(二)">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-20T06:26:07.000Z">2019-12-20</time></div>
                    <a href="/2019/12/20/Node-js项目TypeScript改造指南-二/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Node.js项目TypeScript改造指南(二)</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Node-js/">Node.js</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/12/20/京东微信购物首页性能优化实践/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://tva1.sinaimg.cn/large/006tNbRwgy1ga362ol8snj30p00ann2k.jpg" alt="京东微信购物首页性能优化实践">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-20T06:24:13.000Z">2019-12-20</time></div>
                    <a href="/2019/12/20/京东微信购物首页性能优化实践/" class="title has-link-black-ter is-size-6 has-text-weight-normal">京东微信购物首页性能优化实践</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Web前端/">Web前端</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/12/13/前端-JavaScript-错误分析实践/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://img11.360buyimg.com/jdphoto/s900x383_jfs/t1/89527/23/6466/57930/5df34d33E173747f7/b2ff3068c0cb14cf.png" alt="前端 JavaScript 错误分析实践">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-13T08:43:33.000Z">2019-12-13</time></div>
                    <a href="/2019/12/13/前端-JavaScript-错误分析实践/" class="title has-link-black-ter is-size-6 has-text-weight-normal">前端 JavaScript 错误分析实践</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Web前端/">Web前端</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/12/13/负责任地编写JavaScript代码：第三部分/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://img11.360buyimg.com/jdphoto/s900x383_jfs/t1/102622/29/6464/106030/5df34e11E65297b14/7a2d4157d0519ac6.png" alt="负责任地编写JavaScript代码：第三部分">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-13T08:25:53.000Z">2019-12-13</time></div>
                    <a href="/2019/12/13/负责任地编写JavaScript代码：第三部分/" class="title has-link-black-ter is-size-6 has-text-weight-normal">负责任地编写JavaScript代码：第三部分</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Web前端/">Web前端</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/12/13/负责任地编写JavaScript代码：第二部分/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://img11.360buyimg.com/jdphoto/s900x383_jfs/t1/104367/28/6359/106875/5df34e12E53c7d823/b00b5eaed1b76510.png" alt="负责任地编写JavaScript代码：第二部分">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-13T08:25:46.000Z">2019-12-13</time></div>
                    <a href="/2019/12/13/负责任地编写JavaScript代码：第二部分/" class="title has-link-black-ter is-size-6 has-text-weight-normal">负责任地编写JavaScript代码：第二部分</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Web前端/">Web前端</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">December 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">November 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">October 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">10</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">September 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">July 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">June 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/AST/">
                        <span class="tag">AST</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/BDD-TDD/">
                        <span class="tag">BDD/TDD</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Badjs/">
                        <span class="tag">Badjs</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/CLI/">
                        <span class="tag">CLI</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/CPU性能优化/">
                        <span class="tag">CPU性能优化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/CSS/">
                        <span class="tag">CSS</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/CSS-Houdini/">
                        <span class="tag">CSS Houdini</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Electron/">
                        <span class="tag">Electron</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Interection-Observer/">
                        <span class="tag">Interection Observer</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Mocha/">
                        <span class="tag">Mocha</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Nginx/">
                        <span class="tag">Nginx</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Promise/">
                        <span class="tag">Promise</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/TypeScript/">
                        <span class="tag">TypeScript</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/V8引擎/">
                        <span class="tag">V8引擎</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Vue-compile/">
                        <span class="tag">Vue.compile</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Web性能优化/">
                        <span class="tag">Web性能优化</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/canvas/">
                        <span class="tag">canvas</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/composite/">
                        <span class="tag">composite</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/modulepreload/">
                        <span class="tag">modulepreload</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/rollup打包/">
                        <span class="tag">rollup打包</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/type-module/">
                        <span class="tag">type=&#34;module&#34;</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/webpack-loader/">
                        <span class="tag">webpack loader</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/web内容/">
                        <span class="tag">web内容</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/代码拆分/">
                        <span class="tag">代码拆分</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/前端工程化/">
                        <span class="tag">前端工程化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/向量/">
                        <span class="tag">向量</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/字体/">
                        <span class="tag">字体</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/居中对齐/">
                        <span class="tag">居中对齐</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/工程化/">
                        <span class="tag">工程化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/引导蒙层/">
                        <span class="tag">引导蒙层</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/性能优化/">
                        <span class="tag">性能优化</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/折叠屏适配/">
                        <span class="tag">折叠屏适配</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/桌面开发/">
                        <span class="tag">桌面开发</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/测试框架/">
                        <span class="tag">测试框架</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/滚动优化/">
                        <span class="tag">滚动优化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/火焰图/">
                        <span class="tag">火焰图</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/电池电量/">
                        <span class="tag">电池电量</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/碰撞检测/">
                        <span class="tag">碰撞检测</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/设计原则/">
                        <span class="tag">设计原则</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/资源治理/">
                        <span class="tag">资源治理</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2019/12/20/Node-js项目TypeScript改造指南-二/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://tva1.sinaimg.cn/large/006tNbRwgy1ga362vbkc8j30p00anq52.jpg" alt="Node.js项目TypeScript改造指南(二)">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-20T06:26:07.000Z">2019-12-20</time></div>
                    <a href="/2019/12/20/Node-js项目TypeScript改造指南-二/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Node.js项目TypeScript改造指南(二)</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Node-js/">Node.js</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/12/20/京东微信购物首页性能优化实践/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://tva1.sinaimg.cn/large/006tNbRwgy1ga362ol8snj30p00ann2k.jpg" alt="京东微信购物首页性能优化实践">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-20T06:24:13.000Z">2019-12-20</time></div>
                    <a href="/2019/12/20/京东微信购物首页性能优化实践/" class="title has-link-black-ter is-size-6 has-text-weight-normal">京东微信购物首页性能优化实践</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Web前端/">Web前端</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/12/13/前端-JavaScript-错误分析实践/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://img11.360buyimg.com/jdphoto/s900x383_jfs/t1/89527/23/6466/57930/5df34d33E173747f7/b2ff3068c0cb14cf.png" alt="前端 JavaScript 错误分析实践">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-13T08:43:33.000Z">2019-12-13</time></div>
                    <a href="/2019/12/13/前端-JavaScript-错误分析实践/" class="title has-link-black-ter is-size-6 has-text-weight-normal">前端 JavaScript 错误分析实践</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Web前端/">Web前端</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/12/13/负责任地编写JavaScript代码：第三部分/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://img11.360buyimg.com/jdphoto/s900x383_jfs/t1/102622/29/6464/106030/5df34e11E65297b14/7a2d4157d0519ac6.png" alt="负责任地编写JavaScript代码：第三部分">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-13T08:25:53.000Z">2019-12-13</time></div>
                    <a href="/2019/12/13/负责任地编写JavaScript代码：第三部分/" class="title has-link-black-ter is-size-6 has-text-weight-normal">负责任地编写JavaScript代码：第三部分</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Web前端/">Web前端</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/12/13/负责任地编写JavaScript代码：第二部分/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="https://img11.360buyimg.com/jdphoto/s900x383_jfs/t1/104367/28/6359/106875/5df34e12E53c7d823/b00b5eaed1b76510.png" alt="负责任地编写JavaScript代码：第二部分">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-13T08:25:46.000Z">2019-12-13</time></div>
                    <a href="/2019/12/13/负责任地编写JavaScript代码：第二部分/" class="title has-link-black-ter is-size-6 has-text-weight-normal">负责任地编写JavaScript代码：第二部分</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Web前端/">Web前端</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">December 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">November 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">October 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">10</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">September 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">July 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">June 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/AST/">
                        <span class="tag">AST</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/BDD-TDD/">
                        <span class="tag">BDD/TDD</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Badjs/">
                        <span class="tag">Badjs</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/CLI/">
                        <span class="tag">CLI</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/CPU性能优化/">
                        <span class="tag">CPU性能优化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/CSS/">
                        <span class="tag">CSS</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/CSS-Houdini/">
                        <span class="tag">CSS Houdini</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Electron/">
                        <span class="tag">Electron</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Interection-Observer/">
                        <span class="tag">Interection Observer</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Mocha/">
                        <span class="tag">Mocha</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Nginx/">
                        <span class="tag">Nginx</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Promise/">
                        <span class="tag">Promise</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/TypeScript/">
                        <span class="tag">TypeScript</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/V8引擎/">
                        <span class="tag">V8引擎</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Vue-compile/">
                        <span class="tag">Vue.compile</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Web性能优化/">
                        <span class="tag">Web性能优化</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/canvas/">
                        <span class="tag">canvas</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/composite/">
                        <span class="tag">composite</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/modulepreload/">
                        <span class="tag">modulepreload</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/rollup打包/">
                        <span class="tag">rollup打包</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/type-module/">
                        <span class="tag">type=&#34;module&#34;</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/webpack-loader/">
                        <span class="tag">webpack loader</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/web内容/">
                        <span class="tag">web内容</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/代码拆分/">
                        <span class="tag">代码拆分</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/前端工程化/">
                        <span class="tag">前端工程化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/向量/">
                        <span class="tag">向量</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/字体/">
                        <span class="tag">字体</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/居中对齐/">
                        <span class="tag">居中对齐</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/工程化/">
                        <span class="tag">工程化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/引导蒙层/">
                        <span class="tag">引导蒙层</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/性能优化/">
                        <span class="tag">性能优化</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/折叠屏适配/">
                        <span class="tag">折叠屏适配</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/桌面开发/">
                        <span class="tag">桌面开发</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/测试框架/">
                        <span class="tag">测试框架</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/滚动优化/">
                        <span class="tag">滚动优化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/火焰图/">
                        <span class="tag">火焰图</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/电池电量/">
                        <span class="tag">电池电量</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/碰撞检测/">
                        <span class="tag">碰撞检测</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/设计原则/">
                        <span class="tag">设计原则</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/资源治理/">
                        <span class="tag">资源治理</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level" style="justify-content: center">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/og_image.png" alt="Node.js项目TypeScript改造指南(二)" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2019 wecteam&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="WecTeam on GitHub" href="https://github.com/wecteam">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
    <div style="margin:30px auto 0;text-align: center;">
            
                <!-- 不蒜子统计 -->
                <span id="busuanzi_container_site_pv">
                        本站总访问量<span id="busuanzi_value_site_pv"></span>次
                </span>
                <span class="post-meta-divider">|</span>
                <span id="busuanzi_container_site_uv" style='display:none'>
                        本站访客数<span id="busuanzi_value_site_uv"></span>人
                </span>
                <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            

    </div>

    
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-Hans");</script>

<script>
var IcarusThemeSettings = {
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>



    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>